version: 2.1

orbs:
  win: circleci/windows@4.1.1

jobs:
  make:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - run:
          command: 
            sudo apt-get install build-essential libboost-all-dev xsltproc autorevision
            && make -C src && make -C src/examples && make -C src/test && ./src/test/test

  cmake:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - run:
          command:
            sudo apt-get install build-essential libboost-all-dev xsltproc autorevision
            && mkdir build && cd build && cmake .. && make -j4
 
  cmake-dev:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - run:
          command:
            sudo apt-get install build-essential libboost-all-dev xsltproc autorevision
            && mkdir build-dev && cd build-dev && cmake -DDEVELOPER=1 .. && make -j4 && ctest -V

  vstudio:
    executor: win/default
    steps:
      - checkout
      - run:
          command:
            echo "hello vs"
          

workflows:
  build:
    jobs:
      - vstudio
      - make
      - cmake
      - cmake-dev
